### 明源云

#### 0.springcloud 组件

**Ribbon**：通过RestTemplate的拦截器机制，实现SpringCloud负载均衡，利用applicationName获取注册中心可用的服务列表，然后通过一定算法对请求进行分发。

通过@LoadBalanced注解将RestTempate注入到容器中，@LoadBanlaced继承了@Qualifier注解，实现注入。具体实现通过LoadBalancerInterceptor实现ClientHttpRequestInterceptor接口来完成，在执行拦截的时候通过rule算法进行请求的分发。常用算法有：轮询、权重、随机、根据响应时间选择、过滤处于熔断状态的服务和连接数达到阈值的服务，进行轮询、过滤处于熔断状态选择并发最小的服务。根据server所在区域的可用服务和性能进行选择、通过实现rule接口自定义算法

**Feign**：可插拔声明式、模板化客户端负载均衡，client端可以像调用本地方法一样调用远程服务，不用像使用RestTemplate那样进程代码编写和解析就能完成负载均衡。

使用Feign做负载均衡，需要提供一个标准化的服务接口，在spring底层会根据这个借口生成一个基于jdk实现的代理对象。代理对象的逻辑类似LoadBalancerInterceptor

Feign在进行数据传输的时候会对数据进行GZIP格式的压缩，加快网络传输、节省流量，在使用Feign的时候还必须要配置超时时间，在Ribbon中默认连接超时是1秒，在很多请求中1秒事务完成一个请求到结束的。

**zuul**：支持动态路由、监视、弹性和安全性。zuul路由网关是基于filter来实现的，在client发送请求到达zuul时，都会交给zuulservlet来处理，进入zuul后就会调用各种filter，先调用pre filter在请求路由之前调用一些信息的验证可以在这里处理，route filter请求时被调用，用作请求转发，post filter用作处理响应请求，在调用其中任何一个filter时如果出现异常会调用error filter处理异常的，如果异常能正常处理，会接着执行post filter

**config**：随着服务的迭代升级，常规的配置方式已经无法满足。springcloud config 提供了基于客户端和服务端使用git仓库的版本控制，实现集中式管理分布式环境下的配置信息，与spring的无缝结合，能满足任何语言的开发。

通过bootstrap.yml全部配置文件进行集中管理，根据配置加载远程配置文件。、

但是config-client是无法自动从server中获取配置文件的，除了在服务启动会加载之外。需要借助actuator启动器来实现刷新加载，springcloud默认是关闭该功能，需要在配置文件中开启。并且actuator必须是基于http的post请求，然后通过client调用actuator体统的refresh来刷新。但是这样还是需要人工手动去刷新不能做到实时性。

通过对配置文件的加密，和对请求的安全认证来保证安全性。

**bus**：集成了消息中间件，当有数据变更时，会通过消息中间件的消息广播方式来通知各个节点更新数据

#### 1.熔断用了吗，怎么用的

springcloud hystrix 熔断器，实现服务熔断，降级，限流

**请求熔断**：当hystrix command 请求后端服务失败数量超过一定比列（默认50%，如果没有超过半数，即使全部错误请求也不会开启熔断），会开启断路器，这个时候任何请求后端的服务都会直接失败。断路器在开启一段时间后（默认5秒）会切换到半开路状态，这时会判断下次请求的状态，如果成功则关闭断路器，如果失败则继续开启断路器，避免发送大量无效请求影响系统的吞吐量，我们可以自己设定具体的参数值

**服务降级**：通过请求后端服务抛出异常或者接口访问超过设定的时间，返回服务降级，此时服务不可用

**限流**：在微服务架构中，服务端的请求承载量是有限的，在客户端请求时，我们希望限制请求并发数，防止请求数过大对服务端产生压力，可以通过设置信号量模式下的最大并发量、线程池大小、缓冲区大小、和缓冲区降级阈值

通过继承 HystrixCommand 来完成自定义的逻辑实现，run（）方法处理业务逻辑，getFallback（），做服务的降级处理。如果需要异步处理可以使用execute（）方法来实现，会返回 Futrue来接收返回结果

如果需要请求多个服务返回一组结果可以通过继承HystrixObservableCommand来实现，它是基于RxJava来实现的异步操作

#### 2.分布式锁怎么实现 超时时间设置多少合适

redis

使用redis中的setnx的原子操作，如果担心网络问题，可以设置key 的expire过期时间，在redis中，有一组复杂的命令可以组合 setnx和设置expire在一个事务下执行，不用担心在执行了setnx后突然出现断电或者断网的情况导致没有设置key的expire。

zookeeper

首先需要了解zookeeper的原理，在zookeeper是一个分布式协调服务器。在zookeeper集群中，所有写的操作都会通过master并且是按照顺序执行的。

使用zookeeper的带序列号的临时节点来时分布式锁，通过watch机制，后面的节点watch前面的节点，当前面的节点获取锁释放锁，或者出现断开连接的情况触发watch时间，来通知后面的节点，可以做到有序。

#### 3.首页为什么要拆分单独的服务



#### 4.springcould资源隔离

**Hystrix隔离策略**

**线程池隔离**：调用线程和HystrixCommand线程不是同一个线程，并发请求数受到HystrixCommand所属线程池组中线程数的限制，默认是10，默认使用的线程池隔离策略

**信号量隔离**：调用线程和HystrixCommand线程是同一个线程，默认10。调用快，开销小，由于和调用线程处于同一个线程，所以必须确保调用的服务可用性高，返回快

#### 5.为什么那么多分布式框架要选择springcould

首先，springcloud提供一整套微服务架构技术（说一下常用的组件），社区活跃，和spring能完美集成，通讯的模式restfull。dubbo基于rpc框架的，耦合度高，需要使用第三方的注册中心，redis，zookeeper等，推荐使用zookeeper。

#### 6.mysql主从同步原理，有延时吗

通过logbin日志文件实现，会受网络影响，最好主机和从机部署在同一个机器（redis主从一样）。

主库db的更新操作都会记录在binlog日志文件中，主库会创建一个binlog dump的线程向从库发送binlog的内容

从库会创建一个i/o线程读取主库传送过来的binlog内容并写入到relay log文件中

然后创建一个sql线程从relay log 中读取内容从 exec_master_log_pos的位置开始读取器更新时间并写入到从库

mysql的主从复制是一个异步的过程

#### 7.读写分离是怎么去做的。

通过把读和写操作进行分离，然后读操作访问从库，写操作访问主库，也可以通过mysql插件 MaxScale 

#### 8.一张1000w数据的订单表，10个字段，还有一张500w数据的用户表。8个字段。现在要得到任意两两条件组合的数据2w条。说出三种技术方案

es，redis布隆过滤器

#### 9.应对高并发你们做了哪些工作

redis做缓存，mq做限流，nginx负载均衡，springcloud中ribbon组件负载均衡

#### 10.你们的秒杀做了哪些优化

cdn缓存静态页面，mq限流，redis记录信息，最后再更新到数据库，负载均衡。单独部署模块，尽量保证再出现问题的时候不影响到其他服务的使用

#### 11.hashmap以自定义对象为key，如果不重写hashcode方法会怎么样

hashcode默认是比较两个对象的地址，如果new了两个不同对象的相同属性，因为内存地址不一样，都能保存到map中

#### 12.分别讲讲软引用和弱引用

java中有四种引用

强引用：永远不会被回收，哪怕oom

软引用：内存足够不会被回收

弱引用：只要执行了垃圾回收就会被回收

虚引用：随时都会被回收，提供了对象被回收后的一个通知

#### 13.类加载器分为几层，bootstarp加载器是干什么的、假如只有一个类加载器行不行类加载器如果算上自定义类加载器分为4层，从顶层往下分别是什么

三层，根类加载器，加载java_path下lib下的类库，扩展类加载器，加载ext下的类库，系统类加载器，加载应用的类。

不能只有一个类库，首先，为了区分不同版本同类的类，一方面允许不同应用运行在同一个jvm中，可以对不同类库在运行时的增强，动态代理，为了安全性

### AKULAKU

#### 1.Redisson分布式锁，setNX会有问题https://www.cnblogs.com/diegodu/p/8185480.html

#### 2.Redis选举的机制，怎么知道哪个做leader，cluster讲一下

3.redis分片策略，一致性hash，扩充节点的过程
3.MySQL的innodb的索引原理，B数的特点、为什么要用B树不用hash。聚簇索引了解吗。查询的原理
4.线程池有哪些参数，参数的意义，拒绝策略有哪几种
5.对代码有什么追求吗，设计模式，单例、策略。策略模式的UML图
6.为什么要用spring，spring是怎么把对象注入容器的，spring是怎么解决循环依赖的问题(先创建对象，再去管理依赖关系)
7.springcould有没有深入研究某个组件
8.怎么保证事务提交时，消息推送到队列

华润置地
1.spring事务的原理
2.讲讲CAS
3.mysql优化知道哪些
4.JVM内存模型，调优了哪些参数
5.JUC下的有些什么
6.设计模式常用的有哪些，具体讲讲
7.日常开发中有没有去注意线程安全
8.哪一块是你比较精通的
9.springcould哪些部分比较了解

兴盛优选
1.jvm的内存结构
2.有哪几种回收算法
3.标清标整的区别
4.cms和G1的区别
5.在新生代没有被垃圾收集器清理的对象会怎么样，老年代的依据默认值是多少
6.@autowried的实现原理是怎样的，他在哪一步进行的
7.aop你们是使用场景，实现原理
8.http的403啥意思
9.tcp三次握手是怎么样的，平常说的半链接拦截是发生在哪步
10.MySQL索引底层数据结构有哪几种，hash和B+树的区别
11.Redis存入100和helloworld有什么区别
12.sortset了解吗
13.还说了个算法了解不
14.dubbo有哪几种注册中心
15.rabbitmq有哪几种发送消息的方式
16.事务隔离级别有哪几种
17.死锁什么情况下会出现，活锁了解吗
18.juc常用哪些类，aqs说说，他提供了什么功能
19.十个线程先后执行有哪些实现方式
20.乐观锁用过吗，Java1.8有个工具类提供了乐观锁实现，你知道吗
21.linux常用命令，常用来看负载的三个参数分别是指哪几个时间点

绿米联创
1.最顶级的异常类是什么，什么情况下会用到，他的子类有什么，error什么时候会用到
2.java语法糖有了解吗
3.String a ,b,c; a=“a”;b=“b”;c==“a”+“b”; a+b==c?
4.怎么一行代码把1,2,3，三个数字放到一个list
5.JVM内存模型、垃圾回收算法
6.怎么做到栈溢出
7.新生代和老年代的比例大小，怎么设置老年代的比例
8.jvm怎么查看内存占用情况
9.aqs
10.synchronized的底层原理，它是可重入锁吗。怎么实现可重入锁
11.常用的数据库引擎，innodb和myisam的区别，hash索引和B+树的区别
12.sql优化方式，
13.有a,b,c三列，建了一个 组合索引，和在a上建了索引。现在查询a=？.会选择哪个索引
14.mysql有哪些约束
15.innodb默认的事务隔离级别，要做分布式事务，最高能到哪个隔离级别
16.tcp三次握手，tcp协议是在网络链路哪一层
17.http头部有哪些参数
18.hashmap1.8的改动。写出123456的红黑树
19.集合中有哪些有序的集合
20.linkedhashmap和treemap的区别

拉卡拉
1.先谈整个项目、介绍项目的所用技术
2.对微服务的理解
3.目前项目是怎么拆分的
4.redis哪些地方用到了、解决了什么功能
5.Arraylist是线程安全的吗
6.Hashmap实现原理
7.mysql知道哪些引擎，innodb有哪些特性，什么好处。
8.事物的隔离级别。哪些走索引，不走索引相关的。
9.多线程的生命周期，怎么处理并发的

票据宝
1.hashmap的数据结构组成，hashmap的hashcode()和equals()什么时候会调用
2.hashmap什么时候会rehash()
3.volatile了解吗、他在CPU中有起到什么作用
4.java原生线程池
5.jvm内存结构、堆内存组成、
6.什么情况下会内存溢出，什么情况下会栈溢出
7.多线程顺序是怎么保证的
8.有哪些线程安全的容器
9.treemap是怎么排序的
10.concurrenthashmap在java各个版本中的改进，1.9的防死锁 是怎么解决的
11.threadlocal

蚂蚁金服
1.自我介绍、项目、项目亮点、职责
2.map的底层结构知道吗？初始容量多大？增长因子多大？为什么1.8要换成红黑树呢？红黑树检索高效。
3.红黑树的理解
4.map的key和value的存储类型有什么讲究吗？可以存null，那存进去之后怎么取？value怎么真的什么都可以存？int类型可以存吗？
5.springbean加载过程知道吗
6.jvm启动参数你知道哪些？如果jvm出现oom什么参数可以让内存dump掉
7.幂等性知道吗？你是怎么保证幂等性的，同一笔订单并发请求，你怎么保证只会插入一次
8.你们分布式锁是怎么弄的，什么是乐观锁和悲观锁？
9.你们是怎么去处理并发的
10.threadlocal了解吗？你们做什么用？它是什么底层数据结构？实现原理是什么？为什么能让其他线程无法访问内在空间
11.事务的传播机制了解吗？acid？acid是事务传播机制的什么？
12.序列化方式有哪几种你知道吗?json算序列化方式吗？为什么要序列化
13.AtomicInteger类的理解与使用
14.mysql索引你了解吗？组合索引加载规则怎么样？什么情况下索引会失效？
15.线程池你用过吗？那spring的线程池的初始参数有哪些。拒绝策略是怎么样的？

网络收录(蚂蚁金服)
一面
1 自我介绍和项目
2 Java的内存分区
3 Java对象的回收方式，回收算法。
4 CMS和G1了解么，CMS解决什么问题，说一下回收的过程。
5 CMS回收停顿了几次，为什么要停顿两次。
6 Java栈什么时候会发生内存溢出，Java堆呢，说一种场景，我说集合类持有对象。
7 那集合类如何解决这个问题呢，我说用软引用和弱引用，那你讲一下这两个引用的区别吧。
8 Java里的锁了解哪些，说了Lock和synchronized
9 它们的使用方式和实现原理有什么区别呢？
10 synchronized锁升级的过程，说了偏向锁到轻量级锁再到重量级锁，然后问我它们分别是怎么实现的，解决的是哪些问题，什么时候会发生锁升级。
11Tomcat了解么，说一下类加载器结构吧。
12 说了Spring，问我Spring中如何让A和B两个bean按顺序加载？
13 10亿个数去重，我说用hash分片做，他说可能不均匀，然后我说了bitmap，他说那数字量更多怎么办，我说那就两个bitmap把。他说下一题吧。
二面：技术面
1.讲一下项目
2.做的主要是Java对吧，讲一下多线程把，用到哪些写一下
3.写了thread和runnable，然后写了线程池，又问了线程池由哪些组件组成，有哪些线程池，分别怎么使用，以及拒绝策略有哪些。
4.什么时候多线程会发生死锁，写一个例子吧，然后我写了一个两个线程，两个锁，分别持有一个，请求另一个的死锁实例。
5.集合类熟悉吧，写一个题目，一个字符串集合，找出pdd并且删除。
6.然后说一下Redis吧，是单线程还是多线程，Redis的分布式怎么做？
7.RPC了解么，我说了主要是协议栈+数据格式+序列化方式，然后需要有服务注册中心管理生产者和消费者。
9.TCP三次握手的过程，如果没有第三次握手有什么问题。
三面：技术面
自我介绍
cap了解么，分别指什么，base呢，强一致性和弱一致性有什么方法来做，2pc了解么，说一下大概过程。
负载均衡怎么做的呢，为什么这么做？
了解过集群雪崩么？
MySQL的主从复制怎么做的，具体原理是什么，有什么优缺点。
Redis有哪些集群模式，各自的区别？
项目用到了多线程，如果线程数很多会怎么样？
分布式了解哪些东西，消息队列了解么，用在什么场景，说了削峰，限流和异步。说了kafka，问我怎么保证数据不丢失，以及确保消息不会被重复消费。还问了消息送达确认是怎么做的。
讲一下项目的主要架构，你在里面做了什么
有什么比较复杂的业务逻辑讲一下。
最大的难点是什么，收获是什么。
HR面：
1.工作中遇到的最大挑战是什么，你如何克服的？
2.你最大的优点和最大的缺点，各自说一个？
3.未来的职业发展，短期和长期的规划是什么？



重复支付？怎么保证幂等？

springmvc和springcloud的区别，常用的cloud模块？

redis分布式锁。

系统的高可用怎么保证？

架构优化？

问了mq，没说使用，因为用了redis

redis缓存过期，如果key没过期会不会被清除。

oom怎么处理？





